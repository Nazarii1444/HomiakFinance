## Основні флоу
1. **Флоу аутентифікації/авторизації + управління сесією** — коли користувач логіниться, отримує токен/сесію, і далі виконує операції (перегляд фінансів, транзакції, CRUD над ресурсами).
2. **Флоу виконання фінансових операцій / обробки конфіденційних даних** — коли користувач або система читає, записує, змінює чутливі дані (наприклад, баланси, транзакції, історію).

---

## Threat model: загрози для основних флоу + критичні ризики

| №  | Загроза / Ризик                                                                                        | Як може проявитися / на який флоу впливає                                                                                                                                                                   |
| -- | ------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1  | **Перехоплення облікових даних (credentials theft / interception)**                                    | Якщо передача логіна/пароля або токенів не захищена (HTTP, або слабке шифрування), атакуючий може перехопити сесію — підробити користувача. (флоу 1)                                                        |
| 2  | **Сесійний hijacking / Session fixation / Replay attack**                                              | Якщо сесійні токени/ідентифікатори неправильно генеруються, зберігаються, не мають обмежень по часу/доступу, можливо повторне використання або викрадення сесії. (флоу 1 → флоу 2)                          |
| 3  | **Неправильна авторизація / недостатня перевірка прав (Broken access control)**                        | Користувач може отримати доступ до чужих рахунків, чужих транзакцій, або виконати операції, на які не має прав — через баги або відсутність перевірки. (флоу 2)                                             |
| 4  | **Injection-атаки (SQL injection, NoSQL injection, command injection, if applicable)**                 | Якщо дані від користувача (введення) неправильно перевіряються/ескейпляться — можливі маніпуляції з базою, крадіжка або псування даних. (флоу 2)                                                            |
| 5  | **Передача/зберігання чутливих даних без шифрування / слабке шифрування**                              | Баланси, історія транзакцій, персональні дані можуть бути витягнуті або зчитані, якщо дані “на диску” або “в мережі” не захищені належним чином. (флоу 2)                                                   |
| 6  | **Недостатня валідація або перевірка введених даних (input validation / output encoding)**             | Це може призвести до XSS (якщо є UI), або інших логічних/функціональних багів: наприклад, запис небезпечних даних, зміна поведінки системи. (флоу 2, UI / API)                                              |
| 7  | **CSRF (Cross-Site Request Forgery)** — якщо є web-інтерфейс / API з сесіями / cookie                  | Зловмисник може змусити авторизованого користувача виконати небажані дії, наприклад, переказ грошей. (флоу 2)                                                                                               |
| 8  | **Недостатня логіка аудиту / запису логів / моніторингу — відсутність або слабкий аудит**              | При компрометації облікового запису або атаці може бути важко відстежити, що сталося, хто і коли. (усі флоу)                                                                                                |
| 9  | **Брутфорс / підбор пароля / слабкі паролі / відсутність обмежень на повторні спроби входу**           | Атакуючий може зламати облікові записи або отримати доступ до системи через слабкі облікові дані. (флоу 1)                                                                                                  |
| 10 | **Недостатній захист від логічних/бізнес-логіки атак (business logic abuse)**                          | Навіть якщо технічно все “безпечно”, можна зловживати функціоналом — наприклад, переведення коштів, дублювання запитів, double-spend, race conditions, manipulation with transaction amounts тощо. (флоу 2) |
| 11 | **Вразливості залежностей / сторонніх бібліотек (supply chain / dependency attack)**                   | Якщо проект використовує зовнішні бібліотеки і не перевіряє їх безпеку, можливе виконання шкідливого коду або витік даних. (всі флоу)                                                                       |
| 12 | **Неправильне управління секретами / конфігураціями (storing secrets in repo, credentials hardcoded)** | Якщо API ключі, паролі до БД, сертифікати зберігаються у відкритому коді — компрометація репо = повний контроль. (усі флоу)                                                                                 |

З точки зору **критичності** — найбільша небезпека для фінансового застосунку: 1, 2, 3, 5, 6, 9, 10, 12, 4, 7, 11.

---

## Мінімальний план пом’якшення (Mitigation Plan) для критичних загроз

Ось заходи, які радив би впровадити як мінімум, щоб закріпити безпеку:

1. **Захищена передача та зберігання credentials / сесій**

   * Вимагати HTTPS / TLS для всіх запитів (логін, API, фронт-енд тощо).
   * В жодному разі не передавати або не зберігати пароль у відкритому вигляді. Використовувати хеш + соль, кращі практики для зберігання паролів.
   * Сесійні токени або JWT повинні мати обмежений термін дії, бути підписані/зашифровані, і зберігатися безпечно (HttpOnly, Secure cookie або еквівалент).

2. **Сильна авторизація + контроль доступу (access control)**

   * Чітко розмежувати ролі/привілеї: користувач, адміністратор, etc. Перевірка прав на кожен запит (не лише UI, але й на бекенді).
   * Захист від горизонтального чи вертикального підвищення прав.

3. **Валідація та санітизація всіх введених даних**

   * На стороні серверу: уникати довільних “raw queries”; використовувати parameterized queries / ORM / prepared statements.
   * Перевірка формату, меж, типів даних, обмеження довжини, ймовірної шкідливості.

4. **Шифрування чутливих даних у стані “at rest” і “in transit”**

   * Якщо є база даних з балан­сами, особистими даними — зберігати зашифровані або із застосуванням strong encryption / disk encryption.
   * Всі API / веб-зв’язки через TLS; використовувати сучасні протоколи та конфігурацію.

5. **Обмеження спроб авторизації; захист від брутфорсу**

   * Впровадити rate-limiting, lockout policy, CAPTCHA або MFA (багатофакторна аутентифікація) при повторних невдалих спробах.
   * Політика сильних паролів, обмеження мінімальної довжини та складності.

6. **Session management: безпечне генерування, оновлення, invalidation сесій**

   * Видавати новий токен після логіну, при привілеях, зміні пароля.
   * Реалізувати logout / invalidation, автоматичний таймаут.
   * Захист від replay / fixation — токен має бути незворотним, з csrf-токенами якщо web.

7. **CSRF та інші web-атаки (якщо є frontend / cookies)**

   * Використовувати anti-CSRF токени, або застосовувати SameSite / CSRF-захист при cookie.
   * Перевіряти Origin / Referer або застосовувати double-submit cookie / захист форм.

8. **Аудит, логування і моніторинг дій користувачів та системних подій**

   * Логи входів, невдалих та успішних авторизацій, змін балансу / транзакцій, операцій CRUD.
   * Зберігати логи у недоступній для користувачів формі, з можливістю аналізу, alert-інтеграцією у випадку підозрілої активності.

9. **Не зберігати секрети / конфігурації у відкритому коді / репозиторії**

   * Використовувати environment variables / secrets management.
   * Перевірити репозиторій: якщо там є паролі, ключі, токени – винести їх в безпечне середовище.

10. **Захист від бізнес-логіки зловживань + логічні перевірки**

    * Впровадити перевірки на бекенді для кожної операції: ліміти, перевірка балансу перед транзакцією, перевірка авторизації, одноразові токени для важливих операцій, confirmation flows (2FA, подвійне підтвердження) для критичних дій.
    * Мінімізувати можливості “race condition” чи дублювання транзакцій (atomic operations, транзакції бази, механізми idempotency).

11. **Регулярне оновлення і перевірка зовнішніх залежностей / бібліотек**

    * Використовувати перевірені бібліотеки, утримувати їх у актуальному стані, відслідковувати CVE.
    * За потреби — впровадити сканування залежностей (dependency scanning), аудити безпеки, або lock-файли.

---

## Як threat-model міг би виглядати для двох флоу

### Флоу 1 — Аутентифікація / сесія

* **Входження / Верифікація** → **Генерація токена / сесії** → **Передача токена клієнту (cookie / token)** → **Подальші запити з токеном**

  * Загрози: credentials theft, brute–force, session hijacking, weak password, token replay, insecure transport.
  * Mitigations: TLS, strong password policy, rate-limit + lockout, secure token generation, HttpOnly / Secure cookies, session timeout, MFA.

### Флоу 2 — Операції з фінансовими / чутливими даними

* **Запит користувача (через UI або API) з токеном** → **Авторизація / Перевірка прав** → **Валідація/санітизація введених даних** → **Операція з БД (зміна балансу / створення транзакції / CRUD / читання даних)** → **Відправка відповіді / підтвердження**

  * Загрози: broken access control, injection, data leakage, business-logic abuse, CSRF, weak data encryption, missing audit, dependency vulnerabilities.
  * Mitigations: access control checks, parameterized queries, input validation, encryption at rest/in transit, CSRF protection, logging/audit, business-logic safeguards (limits, confirmation), secure dependencies, config/secrets management.

---
