## Основні флоу
1. **Флоу аутентифікації/авторизації + управління сесією** — коли користувач логіниться, отримує токен/сесію, і далі виконує операції (перегляд фінансів, транзакції, CRUD над ресурсами).
2. **Флоу виконання фінансових операцій / обробки конфіденційних даних** — коли користувач або система читає, записує, змінює чутливі дані (наприклад, баланси, транзакції, історію).

---

## Threat model: загрози для основних флоу + критичні ризики

| №  | Загроза / Ризик                                                                                        | Як може проявитися / на який флоу впливає                                                                                                                                                                   |
| -- | ------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1  | Перехоплення облікових даних (credentials theft / interception)                                    | Якщо передача логіна/пароля або токенів не захищена (HTTP, або слабке шифрування), атакуючий може перехопити сесію — підробити користувача. (флоу 1)                                                        |
| 2  | **Сесійний hijacking **                                              | Якщо сесійні токени/ідентифікатори неправильно генеруються, зберігаються, не мають обмежень по часу/доступу, можливо повторне використання або викрадення сесії. (флоу 1 → флоу 2)                          |
| 3  | **Неправильна авторизація / недостатня перевірка прав (Broken access control)**                        | Користувач може отримати доступ до чужих рахунків, чужих транзакцій, або виконати операції, на які не має прав — через баги або відсутність перевірки. (флоу 2)                                             |
| 4  | **Injection-атаки (SQL injection, NoSQL injection)**                 | Якщо дані від користувача неправильно перевіряються, то можливі маніпуляції з базою, крадіжка або псування даних. (флоу 2)                                                            |
| 5  | **Передача/зберігання чутливих даних без шифрування / слабке шифрування**                              | Баланси, історія транзакцій, персональні дані можуть бути витягнуті або зчитані, якщо дані "на диску" або "в мережі" не захищені належним чином. (флоу 2)                                                   |
| 6  | **Недостатня валідація або перевірка введених даних**             | Це може призвести до XSS або інших логічних/функціональних багів: наприклад, запис небезпечних даних, зміна поведінки системи. (флоу 2)                                              |
| 7  | **CSRF**                  | Зловмисник може змусити авторизованого користувача виконати небажані дії. (флоу 2)                                                                                               |
| 8  | **Недостатня логіка аудиту / запису логів / моніторингу — відсутність або слабкі логи**              | При компрометації облікового запису або атаці може бути важко відстежити, що сталося, хто і коли. (усі флоу)                                                                                                |
| 9  | **Брутфорс / підбір пароля / слабкі паролі / відсутність обмежень на повторні спроби входу**           | Атакуючий може зламати облікові записи або отримати доступ до системи через слабкі облікові дані. (флоу 1)                                                                                                  |
| 10 | **Недостатній захист від логічних/бізнес-логіки атак**                          | Навіть якщо технічно все безпечно, можна зловживати функціоналом: дублювання запитів, race conditions, manipulation with transaction amounts тощо. (флоу 2) |

З точки зору критичності — найбільша небезпека для фінансового застосунку: 1, 2, 3, 5, 6, 9, 10, 12, 4, 7, 11.

---

## Mitigation Plan для критичних загроз

1. **Захищена передача та зберігання credentials / сесій**

   * Вимагати HTTPS / TLS для всіх запитів.
   * Не передавати і не зберігати пароль у відкритому вигляді. Використовувати hash + salt.
   * Сесійні токени або JWT повинні мати обмежений термін дії, бути зашифрованими, і зберігатися безпечно (HttpOnly, Secure cookie або еквівалент).

2. **Авторизація та access control**

   * Розмежувати ролі: користувач, адміністратор тощо. Перевірка прав на кожен запит (і на фронтенді і на бекенді).

3. **Валідація та очистка введених даних**

   * На стороні сервера: уникати "raw queries", використовувати ORM чи prepared statements.
   * Перевірка формату, меж, типів даних, обмеження довжини.

4. **Шифрування чутливих даних у стані "at rest" і "in transit"**

   * Якщо є база даних з балан­сами, особистими даними — зберігати зашифрованими.
   * Всі веб-зв’язки через TLS, використовувати сучасні протоколи та конфігурацію.

5. **Обмеження спроб авторизації; захист від брутфорсу**

   * Додати rate-limiting та 2FA.
   * Політика сильних паролів, обмеження мінімальної довжини та складності.

6. **Session management: безпечне генерування, оновлення, invalidation сесій**

   * Видавати новий токен після логіну, зміні пароля.
   * Реалізувати logout, автоматичний таймаут.
   * Захист від replay / fixation — токен має бути незворотним, з csrf-токенами якщо web.

7. **CSRF та інші web-атаки**

   * Використовувати anti-CSRF токени.
   * Перевіряти Origin / Referer.

8. **Аудит, логування і моніторинг дій користувачів та системних подій**

   * Логи входів, невдалих та успішних авторизацій, змін балансу / транзакцій, операцій CRUD.
   * Зберігати логи у недоступній для користувачів формі, з можливістю аналізу, alert-інтеграцією у випадку підозрілої активності.

9. **Не зберігати секрети / конфігурації у відкритому коді / репозиторії**

   * Використовувати environment variables.

10. **Захист від бізнес-логіки зловживань + логічні перевірки**

    * Впровадити перевірки на бекенді для кожної операції: ліміти, перевірка балансу перед транзакцією, перевірка авторизації, одноразові токени для важливих операцій, confirmation flows (2FA, подвійне підтвердження) для критичних дій.
    * Мінімізувати можливості "race condition" чи дублювання транзакцій (atomic operations, транзакції бази, механізми idempotency).

---

## threat-model для двох флоу

### Флоу 1 — Аутентифікація / сесія

* **Log in / Верифікація** → **Генерація токена** → **Передача токена клієнту** → **Подальші запити з токеном**

  * Загрози: credentials theft, brute–force, session hijacking, weak password, token replay, insecure transport.
  * Mitigations: TLS, strong password policy, rate-limit + lockout, secure token generation, HttpOnly / Secure cookies, session timeout, MFA.

### Флоу 2 — Операції з фінансовими даними

* **Запит користувача (через UI) з токеном** → **Авторизація / Перевірка прав** → **Валідація введених даних** → **Операція з БД** → **Відправка відповіді**

  * Загрози: broken access control, injection, data leakage, business-logic abuse, CSRF, weak data encryption, missing audit, dependency vulnerabilities.
  * Mitigations: access control checks, parameterized queries, input validation, encryption at rest/in transit, CSRF protection, logging/audit, business-logic safeguards (limits, confirmation), secure dependencies, config/secrets management.

---
