## Основні флоу
1. **Флоу аутентифікації/авторизації + управління сесією** — коли користувач логіниться, отримує токен/сесію, і далі виконує операції (перегляд фінансів, транзакції, CRUD над ресурсами).
2. **Флоу виконання фінансових операцій / обробки конфіденційних даних** — коли користувач або система читає, записує, змінює чутливі дані (наприклад, баланси, транзакції, історію).

---

## threat-model для двох флоу

### Флоу 1 — Аутентифікація / сесія

* **Log in / Верифікація** → **Генерація токена** → **Передача токена клієнту** → **Подальші запити з токеном**

  * Загрози: credentials theft, brute–force, session hijacking, weak password, token replay, insecure transport.
  * Mitigations: TLS, strong password policy, rate-limit + lockout, secure token generation, HttpOnly / Secure cookies, session timeout, MFA.
 
| №  | Загроза / Ризик                                                                                        | Як може проявитися / на який флоу впливає                                                                                                                                                                   |
| -- | ------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1.1  | Перехоплення облікових даних (credentials theft)                                    | Якщо передача логіна/пароля або токенів не захищена (HTTP, або слабке шифрування), атакуючий може перехопити сесію — підробити користувача.                                                        |
| 1.2  | **Сесійний hijacking**                                              | Якщо сесійні токени/ідентифікатори неправильно генеруються, зберігаються, не мають обмежень по часу/доступу, можливо повторне використання або викрадення сесії.                          |
| 1.3  | **Недостатня логіка аудиту / запису логів / моніторингу — відсутність або слабкі логи**              | При компрометації облікового запису або атаці може бути важко відстежити, що сталося, хто і коли.                                                                                                |
| 1.4  | **Брутфорс / підбір пароля / слабкі паролі / відсутність обмежень на повторні спроби входу**           | Атакуючий може зламати облікові записи або отримати доступ до системи через слабкі облікові дані.                                                                                                 |


### Флоу 2 — Операції з фінансовими даними

* **Запит користувача (через UI) з токеном** → **Авторизація / Перевірка прав** → **Валідація введених даних** → **Операція з БД** → **Відправка відповіді**

  * Загрози: broken access control, injection, data leakage, business-logic abuse, CSRF, weak data encryption, missing audit, dependency vulnerabilities.
  * Mitigations: access control checks, parameterized queries, input validation, encryption at rest/in transit, CSRF protection, logging/audit, business-logic safeguards (limits, confirmation), secure dependencies, config/secrets management.

| №  | Загроза / Ризик                                                                                        | Як може проявитися / на який флоу впливає                                                                                                                                                                   |
| -- | ------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2.1  | **Сесійний hijacking**                                              | Якщо сесійні токени/ідентифікатори неправильно генеруються, зберігаються, не мають обмежень по часу/доступу, можливо повторне використання або викрадення сесії.                          |
| 2.2  | **Неправильна авторизація / недостатня перевірка прав (Broken access control)**                        | Користувач може отримати доступ до чужих рахунків, чужих транзакцій, або виконати операції, на які не має прав — через баги або відсутність перевірки.                                             |
| 2.3  | **Injection-атаки (SQL injection, NoSQL injection)**                 | Якщо дані від користувача неправильно перевіряються, то можливі маніпуляції з базою, крадіжка або псування даних.                                                             |
| 2.4  | **Передача/зберігання чутливих даних без шифрування / слабке шифрування**                              | Баланси, історія транзакцій, персональні дані можуть бути витягнуті або зчитані, якщо дані "на диску" або "в мережі" не захищені належним чином.                                                    |
| 2.5  | **Недостатня валідація або перевірка введених даних**             | Це може призвести до XSS або інших логічних/функціональних багів: наприклад, запис небезпечних даних, зміна поведінки системи.                                               |
| 2.6  | **CSRF**                  | Зловмисник може змусити авторизованого користувача виконати небажані дії. (флоу 2)                                                                                               |
| 2.7  | **Недостатня логіка аудиту / запису логів / моніторингу — відсутність або слабкі логи**              | При компрометації облікового запису або атаці може бути важко відстежити, що сталося, хто і коли.                                                                                                 |

Найбільша небезпека для фінансового застосунку з точки зору критичності: 1.1, 1.2 (2.1), 2.2, 2.3, 2.4, 2.5, 1.4, 2.6, 2.7.

---

## Mitigation Plan для критичних загроз

1. **Захищена передача та зберігання credentials / сесій**

   * Вимагати HTTPS / TLS для всіх запитів.
   * Не передавати і не зберігати пароль у відкритому вигляді. Використовувати hash + salt.
   * Сесійні токени або JWT повинні мати обмежений термін дії, бути зашифрованими, і зберігатися безпечно (HttpOnly, Secure cookie або еквівалент).

2. **Авторизація та access control**

   * Розмежувати ролі: користувач, адміністратор тощо. Перевірка прав на кожен запит (і на фронтенді і на бекенді).

3. **Валідація та очистка введених даних**

   * На стороні сервера: уникати "raw queries", використовувати ORM чи prepared statements.
   * Перевірка формату, меж, типів даних, обмеження довжини.

4. **Шифрування чутливих даних у стані "at rest" і "in transit"**

   * Якщо є база даних з балан­сами, особистими даними — зберігати зашифрованими.
   * Всі веб-зв’язки через TLS, використовувати сучасні протоколи та конфігурацію.

5. **Обмеження спроб авторизації; захист від брутфорсу**

   * Додати rate-limiting та 2FA.
   * Політика сильних паролів, обмеження мінімальної довжини та складності.

6. **Session management: безпечне генерування, оновлення, invalidation сесій**

   * Видавати новий токен після логіну, зміні пароля.
   * Реалізувати logout, автоматичний таймаут.
   * Захист від replay / fixation — токен має бути незворотним, з csrf-токенами якщо web.

7. **CSRF та інші web-атаки**

   * Використовувати anti-CSRF токени.
   * Перевіряти Origin / Referer.

8. **Аудит, логування і моніторинг дій користувачів та системних подій**

   * Логи входів, невдалих та успішних авторизацій, змін балансу / транзакцій, операцій CRUD.
   * Зберігати логи у недоступній для користувачів формі, з можливістю аналізу, alert-інтеграцією у випадку підозрілої активності.

9. **Не зберігати секрети / конфігурації у відкритому коді / репозиторії**

   * Використовувати environment variables.

10. **Захист від бізнес-логіки зловживань + логічні перевірки**

    * Впровадити перевірки на бекенді для кожної операції: ліміти, перевірка балансу перед транзакцією, перевірка авторизації, одноразові токени для важливих операцій, confirmation flows (2FA, подвійне підтвердження) для критичних дій.
    * Мінімізувати можливості "race condition" чи дублювання транзакцій (atomic operations, транзакції бази, механізми idempotency).


